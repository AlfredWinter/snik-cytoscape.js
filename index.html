<!DOCTYPE html>
<html>
<head>
 <meta charset="utf-8">
 <title>SNIK Ontology Graph</title>
 <script src="cytoscape.js"></script>
 <script src="blueorange.js"></script>
 <script src="style.js"></script>
</head>
<body>
<div id="cy" style="width:100%;height:100vh;background-color:black;"></div>
<script>

function highlightEdges(edges)
{
	if(edges.length)	{edges.style({'line-color': 'rgb(128,255,128)', 'width': 4.0});}
}

// should use the same color as "selector" : "node:selected" in style.js
function highlightNodes(nodes)
{
	if(nodes.length)	{nodes.style({'background-color': 'rgb(255,255,0)'});}
}

function resetHighlighting()
{
	cy.startBatch();
	cy.filter('edge').style({'width':1,'line-color':'white','visibility':'visible'});
	cy.filter('node').style({'background-color':style[0].style[0].css['background-color']});
	cy.endBatch();
}

function showpath(event)
{
	cy.startBatch();
	if(selectedNode)
	{
		resetHighlighting();
		var target = event.cyTarget;
		var aStar = cy.elements().aStar({ root: selectedNode, goal: target });
		path = aStar.path;
		if(path)
		{
			cy.add(path);
			//console.log(path);
			cy.filter('edge').style({'visibility':'hidden'});
			target.connectedEdges().style({'line-color': 'rgb(50,150,50)', 'width':5.0, 'opacity':'1','visibility':'visible'});
			target.connectedEdges().connectedNodes().style({'background-color':'rgb(128,255,128)'});
			path.filter('edge').style({'line-color': 'rgb(128,255,128)', 'width':10.0, 'opacity':'1','visibility':'visible'});
		}
	}
	cy.endBatch();
}

var cy = cytoscape({
	container: document.getElementById('cy'),
	style: style[0].style
	});

cy.add(blueorange.elements);

var selectedNode;
var path;
cy.on('cxttap',"node",showpath);
cy.on('unselect',"node",resetHighlighting);

cy.on('select',"node",function(event)
{
	cy.startBatch();
	//console.log('selected');
	selectedNode = event.cyTarget;
	resetHighlighting();
	highlightEdges(selectedNode.connectedEdges());
	highlightNodes(selectedNode.connectedEdges().connectedNodes());
	cy.endBatch();
});

</script>
	</body>
</html>