<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>SNIK Ontology Graph</title>
	<script src="lib/jquery-3.1.0.min.js"></script>
	<script src="lib/jquery-ui.min.js"></script>
	<script src="lib/cytoscape.min.js"></script>
	<script src="lib/cytoscape-cxtmenu.js"></script>
	<script src="lib/cola.min.js"></script>
	<script src="lib/cytoscape-cola.js"></script>
	<script src="js/style.js"></script>
	<script src="js/menu.js"></script>
	<script src="js/invert.js"></script>
	<script>
		const MODIFIED = "2016-03-23";
		const ONTOLOGY_MODIFIED = "0.3.0, 2016-11-18";
		const SPARQL_ENDPOINT = "http://www.snik.eu/sparql";
		const SPARQL_GRAPH = "http://www.snik.eu/ontology";
		const SPARQL_PREFIX = "http://www.snik.eu/ontology/";//problem: different prefixes for different partial ontologies
		const SPARQL_LIMIT = 100;
		const ONTOLOGY_ISSUE_WARNING = `Please note that this is only for feedback about the underlying ontology, not the web application. \
This visualization is not a real time view on the ontology but a snapshot of version ${ONTOLOGY_MODIFIED}. \
Please check if there is already an issue for your problem. If not, we will consider your feedback for the next milestone, which may take some time.`;
	</script>
	<script src="js/graph.js"></script>
	<script src="js/browsercheck.js"></script>
	<link rel="stylesheet" type="text/css" href="css/style.css" media="screen" />
	<link rel="stylesheet" type="text/css" href="css/overlay.css" media="screen" />
	<link href ="css/jquery-ui.css" rel = "stylesheet">
</head>

<body>
	<noscript><h1>JavaScript is off. <a href="http://enable-javascript.com/">Please enable</a> to view site.</h2></noscript>
	<script>browsercheck();</script>
<div id="top">
	<ul class="dropdown">

		<li class="dropdown">
			<a href="javascript:void(0)" class="dropbtn" onclick="servicesMenu()">Services</a>
			<div class="dropdown-content" id="services">
				<a href="http://www.snik.eu/sparql" target="_blank">SPARQL Endpoint</a>
				<a href="http://lodview.it/lodview/?sparql=http%3A%2F%2Fwww.snik.eu%2Fsparql&prefix=http%3A%2F%2Fwww.snik.eu%2Fontology%2F&IRI=http%3A%2F%2Fwww.snik.eu%2Fontology%2Fmeta%2FTop" target="_blank">RDF Browser</a>
				<a href="http://snik.eu/evaluation" target="_blank">Data Quality Evaluation</a>
			</div>
		</li>

		<li class="dropdown">
			<a href="javascript:void(0)" class="dropbtn" onclick="filterMenu()">Filter</a>
			<div class="dropdown-content" id="filter">
					<span><input type="checkbox" class="filterbox" onclick="filter(this)" checked value="node[source_original='http://www.snik.eu/ontology/meta']" /> meta</span>
					<span><input type="checkbox" class="filterbox" onclick="filter(this)" checked value="node[source_original='http://www.snik.eu/ontology/bb']" /> BB</span>
					<span><input type="checkbox" class="filterbox" onclick="filter(this)" checked value="node[source_original='http://www.snik.eu/ontology/ob']" /> OB</span>
					<span><input type="checkbox" class="filterbox" onclick="filter(this)" checked value="node[source_original='http://www.snik.eu/ontology/ciox']"/>	CioX</span>
					<span><input type="checkbox" class="filterbox" onclick="filter(this)" checked value="node[name='http://www.snik.eu/ontology/meta/EntityType']"/>EntityType</span>
					<span><input type="checkbox" class="filterbox" onclick="filter(this)" checked value="node[name='http://www.snik.eu/ontology/meta/Role']"/>Role</span>
					<span><input type="checkbox" class="filterbox" onclick="filter(this)" checked value="node[name='http://www.snik.eu/ontology/meta/Function']"/>Function</span>
					<span><input type="checkbox" class="filterbox" onclick="filter(this)" checked value="edge[interaction='http://www.w3.org/2000/01/rdf-schema#subClassOf']"/>subClassOf</span>
					<span><input type="checkbox" class="filterbox" onclick="filter(this)" checked value="edge[interaction^='http://www.w3.org/2004/02/skos/core#']"/>inter-ontology-relations</span>
					<span><input type="checkbox" class="filterbox" onclick="filter(this)" checked value="edge[interaction!^='http://www.w3.org/2004/02/skos/core#']"/>non-inter-ontology-relations</span>
					<span><input type="checkbox" class="filterbox" onclick="filter(this)" checked value="edge[interaction='http://www.snik.eu/ontology/meta/subTopClass']"/>subTopClass</span>
					<span><input type="checkbox" class="filterbox" onclick="filter(this)" checked value="node[consolidated<=0]"/>unverified</span>
					<span><input type="text" value="node[name='http://www.snik.eu/ontology/meta/Top']" id="customfilter"/>
								<input type="checkbox" class="filterbox" onclick="this.value=document.getElementById('customfilter').value;filter(this);"/>custom filter</span>
			</div>
		</li>

		<li class="dropdown">
			<a href="javascript:void(0)" class="dropbtn" onclick="optionsMenu()">Options</a>
			<div class="dropdown-content" id="options">
					<span><input type="checkbox" id="cumulativesearch"/>cumulative search</span>
					<span><input type="checkbox" value="false" id="daymode" onclick="invert(this.checked)"/>day mode</span>
			</div>
		</li>

		<li class="dropdown">
			<a href="javascript:void(0)" class="dropbtn" onclick="helpMenu()">Help</a>
			<div class="dropdown-content" id="help">
				<a href="manual.html" target="_blank">Manual</a>
				<a href="troubleshooting.html" target="_blank">Troubleshooting</a>
				<a href="contribute.html" target="_blank">Contribute</a>
				<a href="http://www.snik.eu/" target="_blank">Project Homepage</a>
				<a href="https://github.com/IMISE/snik-ontology/releases/download/0.3.0/snik-0.3-nociox.cys" target="_blank">Download Cytoscape Graph</a>
				<a href="javascript:about()">About SNIK Graph</a>
				<a href="" onclick="ontologyFeedback()">Submit Feedback about the Ontology</a>
				<script>
				function ontologyFeedback()
				{
					if(confirm(ONTOLOGY_ISSUE_WARNING)) {window.open("https://github.com/IMISE/snik-ontology/issues","_blank");}
				}
				</script>
				<a href="https://github.com/IMISE/snik-cytoscape.js/issues" target="_blank">Submit Feedback about the Visualization</a>
			</div>
		</li>

	</ul>

	<form id="search">
		<input type="text" name="query" id="query" list="matches" />
	</form>

	<form>
		<span id="sourcelabel">no source</span>
		<input type="button" value="Set Source" onclick="setSource(selectedNode)" />
		<input type="button" id="centersource" value="Center Source" onclick="cy.center(pathSource)" hidden/>
		<span id="targetlabel">no target </span>
		<input type="button" value="Set Target" onclick="setTarget(selectedNode)" />
		<input type="button" id="centertarget" value="Center Target" onclick="cy.center(pathTarget);" hidden/>
		<input type="button" id="shortestpath" value="Shortest Path" onclick="showPath(pathSource,pathTarget)" hidden/>
		<input type="button" id="spiderworm" value="Spider Worm" onclick="showWorm(pathSource,pathTarget)" hidden/>
		<input type="button" id="doublestar" value="Double Star" onclick="showDoubleStar(pathSource,pathTarget)" hidden/>
		<input type="button" id="resetstyle" value="Reset View" onclick="resetStyle()"/>
		<input type="button" value="Eval" onclick="window.open('http://www.snik.eu/evaluation','_blank')"/>
	  <input type="button" value="Grid" onclick="layout('grid')"/>
		<input type="button" value="Force (Slow)" onclick="layout('cola')"/>
		<input type="button" value="Spring (Slow)" onclick="layout('cose')"/>
		<input type="button" value="Breadthfirst (Slow)" onclick="layout('breadthfirst')"/>
	  <!--<input type="button" value="Load" onclick="loadSparql()"/>-->
	</form>
</div>

	<script>

function layout(name)
{
	console.log(styledNodes);
	cy.nodes(":visible").layout({ name: name });
}

function loadSparql()
{
	// load graph from SPARQL endpoint instead of from the .cyjs file
	// not yet implemented
}

	var removed = {};

	//** Hide or show certain nodes or edges.**/
	function filter(checkbox)
	{
		var selector = checkbox.getAttribute("value");
		if(checkbox.checked) // selected means the elements shall be shown, undo the filter
		{
			var elements = removed[selector];
			if(elements)
			{
				removed[selector] = undefined;
				elements.restore();
			}
		}
		else // unselected checkbox, hide elements by applying filter
		{
			var elements = cy.elements(selector);
			if(elements)
			{
				// if just saving nodes, the edges would get lost
				removed[selector]=elements.union(elements.connectedEdges());
				elements.remove();
			}
		}
		// the more edges are shown, the more transparent they should be
/*			"selector": "edge[!selected]",
			"css":
			{
				"opacity": 0.5,
				"width": 2.0,*/
/*	 for(var i=0; i<document.styleSheets.length; i++)
	 {
	    var sheet = document.styleSheets[i];
	  	console.log(sheet);
	  }*/
		// we overwrite js/style.js which is not listed, thus we just take any one of the .css style sheets
		// sheet = document.styleSheets[0];
		// set to maximum opaqueness for testing
		// something is wrong here
		//sheet.insertRule("edge[!selected] { opacity:1.0;}", 0);
		//console.log(cy.elements().edges().size());
	}
	</script>

	<div id="overlay" class="overlay">
		<h2 id="h2:searchresults">Search Results</h2>
		<a href="javascript:void(0)" class="closebtn" onclick="hideSearchResults()">&times;</a>
		<table id="tab:searchresults"></table>
	</div>

	<script src="js/search.js"></script>

	<div id="cy" style="width:100%;height:100vh;background-color:black;"></div>

	<script>
	$.ajaxSetup({beforeSend:function(xhr){if (xhr.overrideMimeType)
		{xhr.overrideMimeType("application/json");}}});

	$.getJSON("data/snik-ciox.cyjs", function(graph)
	{
		initGraph(document.getElementById('cy'),graph);
		cy.zoom(0.1);
		cy.center(cy.elements().nodes().filter(`node[name= "http://www.snik.eu/ontology/meta/EntityType"]`)[0]);

  })
	.fail(function()
  {
		console.log('snik-ciox.cyjs not found, loading snik.cyjs');
		$.getJSON("data/snik.cyjs", function(graph)
		{
			initGraph(document.getElementById('cy'),graph);
		})
		.fail(function()
		{
			alert('Did not find snik.cyjs, failed to load graph.');
		});

	});
	</script>
</body>
</html>
